2006-03-09  Alexander Larsson  <alexl@redhat.com>

	* eggpapersize.c (egg_paper_size_new):
	Use default size if argument is NULL

2006-03-09  Alexander Larsson  <alexl@redhat.com>

	* Makefile.am:
	* eggpagesetupunixdialog.[ch]:
	Add EggPageSetupUnixDialog

	* configure.in:
	Check for various _NL_* enums

	* eggpapersize.[ch]:
	Pass display_name to custom constructor
	Add egg_paper_size_is_equal, egg_get_paper_size_name_from_ppd_name
	and egg_paper_size_get_default.
	
	* TODO:
	
	* eggprintbackend.h:
	* eggprinter-private.h:
	Add printer_get_paper_sizes.
	
	* eggprintbackendcups.c:
	Implement printer_get_paper_sizes.
	Always load ppds before showing giving the printer object
	to the frontend. This means less flickering in the UI, less
	problems with settings changing after a while, and easier code
	in the frontend.
	
	* eggprinter.[ch]:
	Remove settings-retrieved signal
	Add _egg_printer_get_paper_sizes
	
	* eggprintersettings.c:
	Pass display name to custom page size
	
	* eggprintunixdialog.c:
	Remove handling of settings-retrieved signal
	
	* paper_names.c:
	Major update.
	
	* testshowdialog.c: (main):
	Show a page setup dialog for now.

2006-03-08  Alexander Larsson  <alexl@redhat.com>

	* TODO:
	Added stuff
	
	* acconfig.h:
	* configure.in:
	Add -Werror and GETTEXT_PACKAGE
	
	* eggcupsutils.c: (egg_cups_request_encode_option):
	Fix warning
	
	* eggcupsutils.h:
	Re-indent function prototypes
	
	* eggintl.h:
	Add a local version of gtkintl.h

	* eggpapersize.[ch]:
	Turn EggPaperSize into a boxed type.
	s/EEL/EGG/
	
	* eggpagesetup.c:
	Fixes for EggPaperSize being boxed
	s/EEL/EGG/
	
	* eggprintbackend.h:
	Remove old GtkFileSystem comment
	
	* eggprintbackendcups.c:
	s/availible/available/
	
	* eggprintbackendsetting.h:
	* eggprintbackendsettingset.h:
	* eggprinter.h:
	* eggprintjob.h:
	* eggprintoperation.h:
	* eggprintunixdialog.h:
	Add padding to classes.
	
	* eggprinter.c:
	Add properties
	
	* eggprintoperation-unix.c:
	Fix warning
	run dos2unix on file
	
	* eggprintoperation-win32.c:
	* eggprintoperation.c:
	Fixes for EggPaperSize being boxed
	
	* eggprintsettingwidget.c:
	Add property for source, make constructor use it
	s/availible/available/
	
	* eggprintunixdialog.c: (create_optional_page),
	(create_advanced_page):
	Remove strange bevels on extra tabs
	
2006-03-07  John (J5) Palmieri  <johnp@redhat.com>

	* eggcupsutils.c:
	(egg_cups_result_set_error):
	Make it handle printf like formating
	(egg_cups_request_get_poll_state):
	Indicates if we are in a state where we are reading or writting from
	the http socket
	
	* eggprintbackendcups.c:
	Improve error handling
	(_cups_dispatch_watch_check): 
	Use egg_cups_request_get_poll_state and sets the poll events to
	watch for accordingly

	* eggprintjob.c:
	Revert closing the fd as soon as possible. Calling 
	egg_print_backend_print_stream just sets up a GSource
	which does the heavy lifting.  We need to wait until
	the cache is streamed to CUPS before we can close it.

2006-03-03  Alexander Larsson  <alexl@redhat.com>

	* TODO:
	Updates

2006-03-03  Alexander Larsson  <alexl@redhat.com>

	* eggprintjob-private.h:
	* eggprintjob.c:
	Unlink the tmp file immediately (we keep the fd around).
	Close the fd as soon as possible

2006-02-28  John (J5) Palmieri  <johnp@redhat.com>

	* eggcupsutils.c:
	Add a connection state where we keep trying when cups goes away 
	for a bit
	(egg_cups_request_read_write):
	Check to see if we exceeded our max attempts

2006-02-28  John (J5) Palmieri  <johnp@redhat.com>

	* eggcupsutils.c (egg_cups_request_encode_option):
	Properly encode print options

	* eggprintbackendcups.c (add_cups_options):
	use egg_cups_request_encode_option to encode the option

2006-02-28  Alexander Larsson  <alexl@redhat.com>

	* eggprintbackendcups.c:
	Handle some standard options (copies, collate, etc)

2006-02-24  Alexander Larsson  <alexl@redhat.com>

	* eggprintbackend.h:
	* eggprinter-private.h:
	* eggprinter.[ch]:
	Add printer_prepare_for_print to printer backend.
	This is where a backend can convert generic options to
	backend-specific options.
	Add settings argument to egg_printer_prep_job.
	
	* eggprintbackendcups.c:
	Add empty (for now) prepare_for_print
	In egg_print_backend_cups_print_stream, send cups settings.
	
	
	* eggprintjob-private.h:
	* eggprintjob.[ch]:
	Add setting memeber.
	Fix refcounting bug with printer.
	Call backend prepare_for_print in egg_print_job_prep(). 
	
	* eggprintoperation-unix.c:
	(egg_print_operation_platform_backend_run_dialog):
	Get settings from dialog and pass to job.

2006-02-24  Alexander Larsson  <alexl@redhat.com>

	* eggprintbackendcups.c:
	No need to keep the ppd file around, unlink it after parsing.
	This means we don't leave the file around after e.g. ctrl-c.
	Add more ImageQualityPage whitelisting options
	Add blacklist for cups options (mainly for options that are handled
	independent of the backend).
	
	* eggprintercups-private.h:
	* eggprintercups.c:
	Remove ppd_filename member	
	
	* eggprintunixdialog.c:
	Hide advanced tab if empty.

2006-02-24  Alexander Larsson  <alexl@redhat.com>

	* eggprintunixdialog.c
	(update_dialog_with_new_settings):
	unref and disconnect old settings handler.
	Connect to new settings.
	(clear_per_printer_ui):
	Clear table size after removing children.

2006-02-23  John (J5) Palmieri  <johnp@redhat.com>

	* eggcupsutils.c:
	Fix mismatch in the egg_cups_request_read_write 
	function and prototype name

	* eggprintbackendcups.c:
	implement getting of PPD files
	(cups_printer_get_backend_settings):
	kick off getting PPD if we don't have one yet

	* eggprinter.c:
	Add settings-retrieved signal for async settings retrieval

	* eggprintunixdialog.c:
	Hook up to settings-retrieved signal and update the UI
	when the settings (PPD file for the cups backend) is 
	retrieved

2006-02-23  Alexander Larsson  <alexl@redhat.com>

	* eggprintercups.[ch]:
	* eggprintercups-private.h:
	Add ppd_file to EggPrinterCups (just loads test.ppd for now)
	
	* eggprintbackendcups.c:
	Implement printer_add_backend_settings
	
	* eggprintersettings.c:
	Use color returns TRUE if not specified.
	
	* eggprintunixdialog.c:
	Fix current_page insensitivity
	Fix page ranges parser
	Call backend printer_add_backend_settings

2006-02-23  Alexander Larsson  <alexl@redhat.com>

	* eggprintbackend.[ch]
	* eggprinter-private.h:
	* eggprinter.c:
	Move printer-only operations to _egg_printer_*() which don't need to take
	a backend argument. (The printer knows its backend)
	Add new printer operation agg_backend_settings.
	
	* eggprintbackendcups.c:
	* eggprintjob.c:
	* eggprintunixdialog.c:
	Update due to above changes.

2006-02-23  Alexander Larsson  <alexl@redhat.com>

	* eggprintenums.h:
	Add EggPageSet.
	
	* eggprintersettings.[ch]:
	Add reverse & page_set
	
	* eggprintunixdialog.[ch]:
	Implement egg_print_unix_dialog_set_current_page.
	Initial cut at egg_print_unix_dialog_get_settings, handling
	only backend-independent settings.

2006-02-22  John (J5) Palmieri  <johnp@redhat.com>

	* eggprintbackendcups.c:
	Remove code for sending commands to cups

	* eggcupsutils.[ch]:
	Cleanup and reimplement a more robust cups communications library
	that is not tied to gtk
	Implement the GET protocol so we can get PPDs 

2006-02-22  Alexander Larsson  <alexl@redhat.com>

	* eggprintunixdialog.c:
	Pick smaller font size so portrait 16 pages per sheet doesn't
	cause overruns of the text.

2006-02-22  Alexander Larsson  <alexl@redhat.com>

	* eggprintbackendsetting.c: (egg_print_backend_setting_class_init):
	Fix signal setup.
	
	* eggprintsettingwidget.[ch]:
	Add changed signal and egg_print_setting_widget_get_value
	
	* eggprintunixdialog.c:
	Implement page layout preview.

2006-02-22  Alexander Larsson  <alexl@redhat.com>

	* eggprintunixdialog.c:
	Update collate/reverse icon when checkboxes change.

2006-02-20  John (J5) Palmieri <johnp@redhat.com>

	* eggprintjob.[ch] eggprintjob-private.h:
	Hide details of printing in short lived printjob object

	* eggprintbackend.c (egg_print_backend_print_stream):
	Take a job instead of a printer

	* eggprintbackendcups.c:
	(struct PrintStreamData):
	Use EggPrintJob instead of EggPrinter
	(_cups_dispatch_watch_check):
	Handle result codes correctly in DISPATCH_SEND
	(_cups_request_printer_info_cb): 
	send back an icon name to use in the dialog
	
	* eggprinter.c:
	Add icon support
	(egg_printer_get_icon_name): 
	return the name of the icon that represents this printer (or NULL)
	(egg_printer_create_cairo_surface, egg_printer_print_stream): 
	removed and encapulated in EggPrintJob
	(egg_printer_prep_job):
	Creates and preps a job for printing

	* eggprintoperation-unix.c:
	(EggPrintOperationUnix): 
	remove pointers to the temporary file cache and printers and add EggPrintJob
	which encapulates everything
	(_free_op_unix): 
	renamed to _op_unix_free
	(unix_end_run):
	Use the print job to send the data to the printer
	(egg_print_operation_platform_backend_run):
	Port to using the PrintJob API
	
	* eggprintoperation.c:
	(egg_print_operation_run):
	call cairo_surface_finish so cairo finishes rendering before we call
	end_run

	* eggprintunixdialog.c:
	Show icons in the UI if the printer has one
	
2006-02-20  Alexander Larsson  <alexl@redhat.com>

	* eggprintunixdialog.c:
	Keep current_printer around when selected

2006-02-20  Alexander Larsson  <alexl@redhat.com>

	* eggprintbackendcups.c:
	Remove whitespace after option name
	Remove settings with only one availible option if they are not
	pre-defined gtk+ settings.
	Handle boolean options.
	Handle group whitelisting.
	
	* eggprintbackendsettingset.c:
	Handle NULL group names.
	Don't reorder group names.
	
	* eggprintsettingwidget.c:
	Add colon after labels.
	
	* eggprintunixdialog.c:
	Handle optional settings much better.

2006-02-16  Alexander Larsson  <alexl@redhat.com>

	* eggprintbackendcups.c (group_has_option):
	Fix bug that made us not remove enought installable option
	conflicts.

2006-02-16  Alexander Larsson  <alexl@redhat.com>

	* eggprintbackend.[ch]:
	* eggprintbackendcups.c:
	Make mark_conflicts return true if there were any conflicts.
	
	* eggprintunixdialog.c:
	Show warning if there are any conflicts in the dialog.

2006-02-16  Alexander Larsson  <alexl@redhat.com>

	* eggprintbackend.[ch]:
	Add egg_print_backend_mark_conflicts
	* eggprintbackendcups.c:
	Convert PPD text to utf8.
	Implement conflict marking.
	
	* eggprintbackendsetting.c:
	Don't emit changed if the value didn't actually change. 
	
	* eggprintbackendsettingset.[ch]:
	Add an array with the settings so we keep the ordering of
	the settings.
	
	* eggprintunixdialog.c:
	Mark conflicts in UI.

2006-02-15  Alexander Larsson  <alexl@redhat.com>

	* Makefile.am:
	* eggprintbackend.[ch]:
	Add egg_print_backend_create_settings ()
	* eggprintbackendcups.c:
	Implement create_settings() for cups
	
	* eggprintbackendsetting.[ch]:
	New class. Storage for one backend setting.
	
	* eggprintbackendsettingset.[ch]:
	New class. A set of settings.
	
	* eggprintsettingwidget.[ch]:
	New class. Widget that displays a backend setting
	
	* eggprintunixdialog.[ch]:
	Initial work on hooking up settings.
	
	* test.ppd:
	Used as ppd for now.
	
	* testprint.c: (main):
	Disable set_pdf_target so we can test print dialog.

2006-02-10  Alexander Larsson  <alexl@redhat.com>

	* eggprintunixdialog.c:
	Initial work on the printer ui. 

2006-02-10  John (J5) Palmieri  <johnp@redhat.com>

	* eggprintbackend.c:
	(egg_print_backend_printer_create_cairo_surface): 
	Pass in a file descriptor where we cache the final output 
	before we send it to the printer
	(egg_print_backend_print_stream): 
	Interface to send a file stream to the printer
	
	* eggprintbackendcups.c:
	(_free_cups_printer):
	(struct CupsPrinter):
	removed in favor of subclassing backend specific printers
	(_cups_request_execute):
	Add file decriptor to params for sending file streams
	(_cairo_write_to_cups): Write out to a cache file
	as cairo sends chuncks of data
	(egg_print_backend_cups_printer_create_cairo_surface):
	Pass in a file descriptor where we cache the final output 
	before we send it to the printer
	(struct _PrintStreamData): 
	Userdata used when streaming file to cups
	(_cups_print_cb): 
	Callback called when we are done streaming a file
	(egg_print_backend_cups_print_stream): 
	Sets up an async call to stream a file to cups for printing
	Implements egg_print_backend_print_stream
	(_cups_dispatch_watch_check): 
	Add a new state DIPATCH_CHECK
	Stream a file in 8k chuncks in DISPATCH_SEND if we have a file descriptor
	Add length of stream to header if we have a file descriptor
	(_cups_request_execute):
	Add file descriptor param
	
	* eggprinter.c:
	(egg_printer_get_backend):
	Return the backend and ref it

	* eggprintercups.c:
	* eggprintercups.h:
	* eggprintercups-private.h:
	Subclass eggprinter with backend specific data

	* eggprintoperation-unix.c:
	(unix_finish_send): 
	Callback triggered when we finish sending a file to cups
	(unix_end_run):
	Send the cached file stream to the backend
	(egg_print_operation_platform_backend_run):
	Get a ref to the backend that we release after the printing is done
	Open up a temp file for caching print output
	
2006-02-07  John (J5) Palmieri  <johnp@redhat.com>

	* eggprintoperation-unix.c (egg_print_operation_platform_backend_run):
	remove ref since printer object is already reffed in the API

	* eggprintunixdialog.c:
	Add model/view to printer list

2006-02-07  John (J5) Palmieri  <johnp@redhat.com>

	* eggprintprinter-private.h:
	* eggprintprinter.c:
	* eggprintprinter.h:
	eggprintprinter renamed to eggprinter

	* eggprinter-private.h:
	* eggprinter.c:
	* eggprinter.h:
	Moved all data into private stuct and added accessor functions
	(egg_print_printer_get_backend):
	Added a backend member and API for accessing backend
	(egg_print_printer_create_cairo_surface):
	Added convinience API for getting a cairo surface directly
	from the printer 
	
	* eggprintoperation-unix.c:
	(egg_print_operation_platform_backend_run):
	Don't worry about the backend anymore as it is encapulated
	in the printer object

2006-02-07  Alexander Larsson  <alexl@redhat.com>

	* eggprintbackend.h:
	Correct cairo include

2006-02-07  Alexander Larsson  <alexl@redhat.com>

	* TODO:
	Add todo file

2006-02-06  John (J5) Palmieri  <johnp@redhat.com>

	* eggprintprinter-private.h:
	* eggprintprinter.c:
	* eggprintprinter.h:
	New printer object for describing UI element publicly and
	backend specific data privately

	* Makefile.am:
	Add eggprintprinter to the mix

	* eggprintbackend.c:
	Signals now return the printer object instead of just the printer name
	(egg_print_backend_printer_get_*): 
	All removed in favor of using the printer object
	(egg_print_backend_printer_create_cairo_surface):
	New interface for getting a cairo surface to print on from the backend
	(egg_print_backend_find_printer):
	New interface for finding a printer given the name of the printer
	
	* eggprintbackendcups.c:
	Revamp for using the printer object and hook up to print.
	Can now print to a PDF stream which is displayed in the console.
	TODO: Send the PDF stream to CUPS

	* eggprintunixdialog.c:
	Revamped to use printer object
	(egg_print_unix_dialog_get_selected_printer): New method for
	getting the currently selected printer and associated backend
	
	* eggprintoperation-unix.c:
	Hooked up all the printing bits so it now "prints"

2006-02-03  John (J5) Palmieri  <johnp@redhat.com>

	* eggprintoperation.c:
	* eggprintoperation-private.h: 
	* eggprintoperation-unix.c:
	* eggprintoperation-win32:
	* eggprintoperation-dubby:
	Fix typo in egg_print_operation_platform_backend_run_dialog 
	s/platfrom/platform

2006-02-03  Alexander Larsson  <alexl@redhat.com>

	* testprint.c (main):
	Clean up demo a bit

2006-02-03  Alexander Larsson  <alexl@redhat.com>

	* eggprintoperation-private.h:
	* eggprintoperation-win32.c:
	* eggprintoperation.[ch]:
	Add error handling to operation_run()

	* printedit.c:
	More polish, convert to unix linefeeds

	* testprint.c:
	Update to new api

2006-02-02  John (J5) Palmieri  <johnp@redhat.com>

	* Makefile.am:
	* configure.in
	* eggprintbackend.c, eggprintbackend.h, eggprintbackendcups.c,
	eggprintbackendcups.h, eggprintunixdialog.c, eggprintunixdialog.h,
	testshowdialog.ci, eggprintoperation-unix.c:
	First code drop for the Unix print dialog and CUPS printing backend

2006-02-02  Alexander Larsson  <alexl@redhat.com>

	* Makefile.am: 
	* printedit.c:
	New test app. Small editor that can print.

2006-02-02  Alexander Larsson  <alexl@redhat.com>

	* eggprintoperation-win32.c (win32_end_page):
	Enable and fix the win32 per-page settings.

2006-02-02  Alexander Larsson  <alexl@redhat.com>

	* eggprintoperation-win32.c:
	Initial work to handle per-page settings, disabled due to
	it not working.

2006-02-02  Alexander Larsson  <alexl@redhat.com>

        * eggprintoperation.c:
	Handle print ranges
	
        * eggprintoperation-win32.c:
	More win32 implementation
	
	* eggprintersettings.c:
	Some small fixes

	* eggprintenums.h:
	* eggprintoperation-private.h
	* eggprintcontext.c:
	Some cleanup
	Add/Remove TODO comments

2006-02-01  Alexander Larsson  <alexl@redhat.com>

	* eggprintoperation.c (egg_print_operation_get_printer_settings):
	ref return value

2006-02-01  Alexander Larsson  <alexl@redhat.com>

	* eggprintoperation-win32.c:
	Add support for lots of settings in dialog_from_printer_settings.

	* eggprintoperation-private.h:
	* eggprintoperation.[ch]:
	Add current_page and way to set it

	* eggprintersettings.[ch]: 
	* eggprintenums.h:
	Add EggPrintPages

	* eggprint-win32.h:
	Add missing defines

2006-02-01  Alexander Larsson  <alexl@redhat.com>

	* eggprintersettings.[ch]:
	Add a lot more settings

	* eggprintenums.h:
	Add more orientations
	Add print quality and duplex enums

2006-02-01  Alexander Larsson  <alexl@redhat.com>

	* eggprintoperation.c:
	Handle page setup better.
	Fix some leaks

	* eggprintoperation-win32.c:
	Handle orientation in printer settings.

	* eggprintersettings.[ch]:
	Add egg_printer_settings_get/set_length()
	Use it for page size

	* eggpagesetup.c (egg_page_setup_init):
	Default margins to 0.25 inch

	* testprintfileoperation.[ch]:
	Take font size instead of lines per page as argument

	* testprint.c:
	Update to the new TestPrintFileOperation API

2006-01-31  Alexander Larsson  <alexl@redhat.com>

	* eggprintoperation-win32.c:
	Add support for driver specific data and driver version

	* eggprintersettings.[ch]:
	Add has_key and get/set_int
	Add some windows specific keys
	
	
2006-01-31  Alexander Larsson  <alexl@redhat.com>

	* eggprintoperation-win32.c:
	Initial setup to handle settings.
	Just printer name is handled atm.

	* eggprintersettings.c (egg_printer_settings_copy):
	Fix crash

