2007-03-04  Dan Winship  <danw@novell.com>

	* eggsmclient-win32.c: Redo this to fix quit_requested handling,
	by listening for WM_QUERYENDSESSION messages in another thread
	that can then block waiting for the main thread to handle it. More
	of #399315.
	(sm_client_win32_end_session): EWX_FORCE means "don't allow
	clients to cancel", not "don't show a logout dialog" (which
	ExitWindowsEx never does), so don't use it to implement the
	request_confirmation flag.

	* Makefile.am: make this work on both unix and windows

	* README: Update. In particular, note that EggSMClientWin32
	requires "-mwindows" and g_thread_init().

	* egg-session-end.c (main): call g_thread_init

	* logout-test.c (main): call g_thread_init, fix window-closed
	handler

	* eggsmclient.c (egg_sm_client_save_state): don't try to compile
	this on Windows. (Temporary workaround)

2007-02-10  Dan Winship  <danw@novell.com>

	* egglauncher.c: New, replaces EggDesktopFile (as a replacement
	for GnomeDesktopItem...)

	* eggdesktopfile.c: gone

	* egg-launch.c: test program

	* eggsmclient-xsmp.c (set_restart_properties): use EggLauncher

2007-02-10  Dan Winship  <danw@novell.com>

	* eggsmclient-win32.c: Make this compile and at least partially
	work (quit_requested doesn't work and probably needs to be
	rewritten using a second thread as suggested in the comments in
	will_quit()). Patch from Yevgen Muntyan, #399315.

	* eggsmclient-xsmp.c: Use gdk_threads_enter/_leave around gtk
	calls and EggSMClient signal emissions. Based on a patch from
	Yevgen Muntyan.

	* Makefile.am:
	* eggsmclient.c (egg_sm_client_get): Change the #defines from
	HAVE_XSMP and HAVE_DBUS to EGG_SM_CLIENT_BACKEND_XSMP and
	EGG_SM_CLIENT_BACKEND_DBUS, to avoid being tricked by the app
	having its own HAVE_DBUS define. Needs to be fixed better though.
	Also change the win32 check from G_OS_WIN32 to
	GDK_WINDOWING_WIN32, since it assumes the win32 gdk backend.

	* logout-test.c: New test program to test logout
	notification/cancellation support (and demonstrate that it doesn't
	really work on Windows).

2007-01-18  Dan Winship  <danw@novell.com>

	* README: add more GnomeClient porting notes based on an email
	exchange with Jani Monoses

